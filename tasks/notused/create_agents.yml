---
    - name: remove agents from known_hosts file
      command: /usr/bin/ssh-keygen -R {{ item }} 
      with_sequence: start={{ start_id }} end={{ end_id }} format=agent%05x

    - name: launch agent instances
      command: "{{ gcloudbin }} compute --project {{ project }} instances create {{ item }} --zone {{ zone }} --machine-type {{ agent_machine_type }} 
               --subnet {{ subnet }}  --maintenance-policy {{ agent_instance_type }} --tags \"privateagent\" --scopes {{ scopes }} 
               --image {{ image }} --boot-disk-size 10 
               --boot-disk-type pd-standard --boot-disk-device-name boot"
      with_sequence: start={{ start_id }} end={{ end_id }} format=agent%05x
      register: vm_instances
      async: 7200
      poll: 0
     
    - name: wait for instance creation to complete
      async_status: jid={{ item.ansible_job_id }}
      register: instances_jobs
      until: instances_jobs.finished
      retries: 300
      with_items: "{{ vm_instances.results }}"
